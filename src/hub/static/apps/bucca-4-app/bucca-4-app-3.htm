<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
        html {
            background: url(img/bg4.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            font-family: "Roboto", sans-serif;
        }

        @font-face {
            font-family: Orbitron;
            src: url(./css/font/orbitron-medium.otf);
        }

        @font-face {
            font-family: DejaVu Sans Mono;
            src: url(./css/font/DejaVuSansMono.ttf);
        }

        body,
        #Text1,
        #Text2,
        #Text3,
        #Text4,
        #Text5 {
            overflow: hidden !important;
        }

        body {
            //background-image: url(./images/sfondo.png);
            background-repeat: no-repeat;
            margin-left: 0px;
            margin-top: 0px;
            margin-right: 0px;
            margin-bottom: 0px;
        }

        a {
            font: 17px Orbitron;
            color: rgb(37, 41, 74);
        }

        #ScassoTitolo {
            position: absolute;
            width: 1920px;
            height: 95px;
            top: 0px;
            left: 0px;
            z-index: 1;
            background-image: url(./images/scasso.png);
            background-origin: border-box;
            background-repeat: no-repeat;
            color: #FFF;
            font-family: Orbitron;
            font-size: 60px;
            padding-left: 60px;
            padding-top: 20px;
        }

        #DivCanvas {
            position: absolute;
            width: 1920px;
            height: 1080px;
            z-index: 0;
            left: 0px;
            top: 0px;
        }

        #Text1 {
            position: absolute;
            width: 920px;
            height: 140px;
            z-index: 2;
            left: 25%;
            top: 25px;
            background: rgba(255, 255, 255, 0.8);
            font: 20px DejaVu Sans Mono;
            overflow-y: scroll;
            resize: none;
            outline: 2px dashed #FF9900;
            box-shadow: 0 0 0 2px #0000FF;
            padding: 10px;
        }

        #Text2 {
            position: absolute;
            width: 890px;
            height: 205px;
            z-index: 2;
            left: 1%;
            top: 230px;
            background: rgba(255, 255, 255, 0.8);
            font: 20px DejaVu Sans Mono;
            overflow-y: scroll;
            resize: none;
            border: 1px solid #FF9900;
            padding: 10px;
            display: none;
        }

        #Text3 {
            position: absolute;
            width: 890px;
            height: 205px;
            z-index: 2;
            right: 1%;
            top: 230px;
            background: rgba(255, 255, 255, 0.8);
            font: 20px DejaVu Sans Mono;
            overflow-y: scroll;
            resize: none;
            border: 1px solid #0000FF;
            padding: 10px;
            display: none;
        }

        #Text4 {
            position: absolute;
            width: 890px;
            height: 335px;
            z-index: 2;
            left: 1%;
            top: 500px;
            background: rgba(255, 255, 255, 0.8);
            font: 20px DejaVu Sans Mono;
            overflow-y: scroll;
            resize: none;
            border: 1px solid #FF9900;
            padding: 20px;
            display: none;
        }

        #Text5 {
            position: absolute;
            width: 890px;
            height: 235px;
            z-index: 2;
            right: 1%;
            top: 500px;
            background: rgba(255, 255, 255, 0.8);
            font: 20px DejaVu Sans Mono;
            overflow-y: scroll;
            resize: none;
            border: 1px solid #0000FF;
            padding: 20px;
            display: none;
        }

        a {
            font: 17px Orbitron;
            color: rgb(37, 41, 74);
        }

        .titolo {
            font: 25px Orbitron;
            color: rgb(37, 41, 74);
        }

        .target {
            color: rgb(37, 41, 74);
            font-weight: bold;
        }

        .att {
            font: 20px Orbitron;
            line-height: 2em;
            color: red;
            display: none;
        }

        .att2 {
            font: 20px Orbitron;
            line-height: 2em;
            color: green;
            display: none;
        }

        input {
            font: 20px DejaVu Sans Mono;
            border: 1px solid #999999;
        }

        #congruo {
            width: 40px;
        }

        button {
            font: 20px DejaVu Sans Mono;
        }

        #button0 {
            position: absolute;
            top: 980px;
            left: 20px;
        }

        input[readonly] {
            resize: none;
            background: rgb(220, 220, 220);
        }

        #primop,
        #generatore,
        #segretoalice,
        #segretobob {
            color: black !important;
            background: white !important;
        }
    </style>
    <link href='./css/jquery-ui.min.css' rel="stylesheet" />
    <link href='./css/keyboard.css' rel="stylesheet" />
    <script src='./js/jquery-3.1.1.min.js' type="text/javascript"></script>
    <script src='./js/jquery-latest.min.js' type="text/javascript"></script>
    <script src='./js/jquery-ui.min.js' type="text/javascript"></script>
    <script src='./js/jquery.keyboard.js' type="text/javascript"></script>
    <script type="text/javascript">
        jQuery(function($) {
            $('#text').keyboard({
                layout: 'num'
            });
            $('.version').html('(v' + $('#text').getkeyboard().version + ')');
            $('#sceglia').keyboard({
                layout: 'num',
                restrictInput: true,
                preventPaste: true,
                autoAccept: true
            });
            $('#sceglib').keyboard({
                layout: 'num',
                restrictInput: true,
                preventPaste: true,
                autoAccept: true
            });
            $('#chiavetrovata').keyboard({
                layout: 'num',
                restrictInput: true,
                preventPaste: true,
                autoAccept: true
            });
        });
    </script>
    <script type="text/javascript">
        Lingua = 1;

        Traduzioni = [
            [
                ["Trad1"], "Angela chose the two numbers: <br> a prime number <em> p </em>:", "Angela ha scelto i due numeri: <br>un numero primo <em>p</em>:", "&Acirc;ngela escolheu os dois n&uacute;meros: <br> um n&uacute;mero primo <em> p </em>:", "Angela w&auml;hlt die beiden Zahlen: <br> eine Primzahl <em> p </em>:"
            ],
            [
                ["Trad2"], "and a number <em> g </em> which will be our base:", "e un numero <em>g</em> che sarà la nostra base:", "e um n&uacute;mero <em> g </em> que ser&aacute; nossa base:", "und eine Zahl <em> g </ em>, die unsere Basis sein wird:"
            ],
            [
                ["Trad3"], "Let's get started!", "Ok, iniziamo!", "Vamos começar!", "Lass uns anfangen!"
            ],
            [
                ["Trad4"], "Phase 2 (Leo): Leo's secret", "Fase 2 (Leo): il segreto di Leo", "Fase 2 (Leo): o segredo de Leo", "Phase 2 (Leo): Leos Geheimnis"
            ],
            [
                ["Trad5"], "Hi Mathina! I secretly chose a number a, between 2 and", "Ciao Mathina! Ho scelto segretamente un numero a, tra 2 e", "Oi Mathina! Eu secretamente escolhi um n&uacute;mero a, entre 2 e", "Hallo Mathina! Ich habe heimlich eine Zahl a zwischen 2 und 2 gew&auml;hlt"
            ],
            [
                ["Trad6", "Trad6a"], "Then I computed", "Poi ho calcolato", "Ent&atilde;o eu calculei", "Dann habe ich berechnet"
            ],
            [
                ["Trad7", "Trad7a"], "which is equal to", "che vale", "que &eacute; igual a", "das ist gleich"
            ],
            [
                ["Trad8", "Trad8a"], "And now?", "E adesso?", "E agora?", "Und nun?"
            ],
            [
                ["Trad9"], "Phase 2 (Mathina): Mathina's secret", "Fase 2 (Mathina): il segreto di Mathina", "Fase 2 (Mathina): o segredo de Mathina", "Phase 2 (Mathina): Leos Mathina"
            ],
            [
                ["Trad10"], "Hi Leo! I secretly chose a number b, between 2 and", "Ciao Leo! Ho scelto segretamente un numero b, tra 2 e", "Oi Leo! Eu secretamente escolhi um n&uacute;mero b, entre 2 e", "Hallo Leo! Ich habe heimlich eine Zahl b zwischen 2 und 2 gew&auml;hlt"
            ],
            [
                ["Trad11"], "How do we proceed?", "Come procediamo?", "Como procedemos?", "Wie Fahren wir fort?"
            ],
            [
                ["Trad12"], "We need to find the key. We know that", "Dobbiamo trovare la chiave. Sappiamo che vale", "Precisamos encontrar a chave. N&oacute;s sabemos isso", "Wir m&uuml;ssen den Schl&uuml;ssel finden. Wir wissen das"
            ],
            [
                ["Trad13"], "but also", "ma anche", "mas tamb&eacute;m", "aber auch"
            ],
            [
                ["Trad14"], "only not knowing a and b we are forced to try various combinations.", "solo che non conoscendo a e b siamo obbligati a provare varie combinazioni.", "apenas n&atilde;o conhecendo aeb, somos for&ccedil;ados a tentar v&aacute;rias combina&ccedil;&otilde;es.", "Nur wenn wir a und b nicht kennen, m&uuml;ssen wir verschiedene Kombinationen ausprobieren."
            ],
            [
                ["Trad15", "Trad15a"], "Choose", "Scegli", "Escolher", "W&auml;hlen"
            ],
            [
                ["Trad16", "Trad16a"], "with this choice", "Con questa scelta", "com esta escolha", "mit dieser Wahl"
            ],
            [
                ["Trad17", "Trad17a"], "modulo", "modulo", "m&oacute;dulo", "Modulo"
            ],
            [
                ["Trad18"], "Ok, I'm ready to decode the message", "Ok, sono pronto a decodificare il messaggio", "Ok, estou pronto para decodificar a mensagem", "Ok, ich bin bereit, die Nachricht zu entschl&uuml;sseln"
            ],
            [
                ["Trad19"], "Can we decode the message?", "Riusciamo a decodificare il messaggio?", "Podemos decodificar a mensagem?", "K&ouml;nnen wir die Nachricht entschl&uuml;sseln?"
            ],
            [
                ["Trad20"], "Enter the key:", "Inserisci la chiave:", "Insira a chave:", "Geben Sie den Schlüssel:"
            ],
            [
                ["Trad21"], "Here is the decoded message", "Ecco il messaggio decodificato", "Aqui est&aacute; a mensagem decodificada", "Hier ist die dekodierte Nachricht"
            ]
        ];

        function isNumeric(n) {
            return !isNaN(parseFloat(n)) && isFinite(n);
        }

        function gup(name, url) {
            if (!url) url = location.href;
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(url);
            return results == null ? null : results[1];
        }


        function Traduci(Lang) {
            for (var k = 0; k < Traduzioni.length; k++) {
                for (var kk = 0; kk < Traduzioni[k][0].length; kk++) {
                    if (document.getElementById(Traduzioni[k][0][kk]) != null) document.getElementById(Traduzioni[k][0][kk]).innerHTML = Traduzioni[k][Lang];
                }
            }
        }

		function Resize() {
            var doc = document,
                w = window;
            var docEl = (doc.compatMode && doc.compatMode === 'CSS1Compat') ?
                doc.documentElement : doc.body;

            var width = docEl.clientWidth;
            var height = docEl.clientHeight;

            // mobile zoomed in?
            if (w.innerWidth && width > w.innerWidth) {
                width = w.innerWidth;
                height = w.innerHeight;
            }

            window.dimension = [width, height];
            console.log(dimension);
			
			var ScalaCalcolata=Math.min(dimension[0]/1920,dimension[1]/1080);
			document.body.style.zoom=ScalaCalcolata;
        }

        function Init() {

            Lingua = Number(gup('l', document.location.search));
            if (!isNumeric(Lingua)) Lingua = 1;
            if (Lingua == 0) Lingua = 1;
            Traduci(Lingua);
			
			window.addEventListener('resize', Resize, false);

            ListaPrimi = [19, 23, 29, 31, 37, 41, 43];
            PrimoScelto = ListaPrimi[Math.floor(Math.random() * ListaPrimi.length)];
            document.getElementById("Primo1").innerHTML = PrimoScelto;
            BaseScelta = 2 + Math.floor(Math.random() * (PrimoScelto - 3));
            document.getElementById("Base1").innerHTML = BaseScelta;
            Giusta1 = Math.floor(Math.random() * 4) + 1;
            Giusta2 = Math.floor(Math.random() * 4) + 1;
            diffie();
            UpdateLabels();
            //document.getElementById("codem").innerHTML=RandomString(25,Alphabet);
        }

        function RiempiForm(l) {}

        function GeneraCaso(l) {
            switch (Math.floor(Math.random() * 4)) {
                case 0:
                    return "<em>" + l + "</em><sup>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</sup> modulo <em>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</em>= " + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "<span></span>";
                    break;
                case 1:
                    return "<em>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</em><sup>" + l + "</sup> modulo <em>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</em>= " + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "<span></span>";
                    break;
                case 2:
                    return "<em>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</em><sup>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</sup> modulo <em>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</em>= " + l + "<span></span>";
                    break;
                default:
                    return "<em>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</em><sup>" + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "</sup> modulo <em>" + l + "</em>= " + (2 + Math.floor(Math.random() * (PrimoScelto - 3))) + "<span></span>";
            }
        }
        // JavaScript Document
        function isPrime(n) {
            if (n == 2) {
                return true
            }
            if (n < 2) {
                return false
            }
            if (n != Math.round(n)) {
                return false
            }
            if (n % 2 == 0) {
                return false
            }
            var isPrime = true;
            var sq = Math.sqrt(n);
            for (var i = 3; i <= sq; i = i + 2) {
                if (n % i == 0) {
                    isPrime = false
                }
            }
            return isPrime;
        }

        function potmod(bb, ee, nn) {
            var xx = 1;
            for (ii = 0; ii < ee; ii++) {
                xx = xx * bb;
                xx = xx % nn;
            }
            return xx;
        }
        Alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

        function RandomString(N, Alfabeto) {
            var Risp = "";
            for (let i = 0; i < N; i++) {
                Risp = Risp + Alfabeto[Math.floor(Math.random() * Alfabeto.length)];
            }
            return Risp;
        }

        function diffie() {
            p = PrimoScelto;
            g = BaseScelta;
            a = 2 + Math.floor(Math.random() * (p - 3));
            A = potmod(g, a, p);
            b = 2 + Math.floor(Math.random() * (p - 3));
            B = potmod(g, b, p);
            segretoA = potmod(B, a, p);
            segretoB = potmod(A, b, p);
            RiempiForm(a);
            UpdateLabels();
            document.getElementById("chia").innerHTML = A;
            document.getElementById("chib").innerHTML = B;
            //document.getElementById("segra").innerHTML = segretoA;
            //document.getElementById("segrb").innerHTML = segretoB;
        }

        function UpdateLabels() {
            if (typeof a !== 'undefined' && isNaN(a) == false) {
                var Lista = document.getElementsByClassName("SegMatA");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = a;
            } else {
                var Lista = document.getElementsByClassName("SegMatA");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = "a";
            }
            if (typeof B !== 'undefined' && isNaN(B) == false) {
                var Lista = document.getElementsByClassName("SegCondB");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = B;
            } else {
                var Lista = document.getElementsByClassName("SegCondB");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = "B";
            }
            if (typeof A !== 'undefined' && isNaN(A) == false) {
                var Lista = document.getElementsByClassName("SegCondA");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = A;
            } else {
                var Lista = document.getElementsByClassName("SegCondA");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = "A";
            }
            if (typeof b !== 'undefined' && isNaN(b) == false) {
                var Lista = document.getElementsByClassName("SegMatB");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = b;
            } else {
                var Lista = document.getElementsByClassName("SegMatB");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = "b";
            }
            if (typeof BaseScelta !== 'undefined') {
                var Lista = document.getElementsByClassName("SegG");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = BaseScelta;
            }
            if (typeof BaseScelta !== 'undefined') {
                var Lista = document.getElementsByClassName("SegP");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = PrimoScelto;
            }
            var Lista = document.getElementsByClassName("pmuno");
            for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = PrimoScelto - 2;
            if (typeof B !== 'undefined' && isNaN(B) == false) {
                var Lista = document.getElementsByClassName("SegCondB");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = B;
            } else {
                var Lista = document.getElementsByClassName("SegCondB");
                for (let i = 0; i < Lista.length; i++) Lista[i].innerHTML = "B";
            }
        }

        function CheckFinale() {
            ChiaveUtente = parseInt(document.getElementById("chiavetrovata").value);
            if (ChiaveUtente == segretoB) {
                document.getElementById("messdec").innerHTML = "Giusto";
            } else {
                document.getElementById("messdec").innerHTML = "Sbagliato";
            }
        }

        function ScegliA() {
            nna = document.getElementById("sceglia").value;
            na = parseInt(nna);
            Cond1 = potmod(B, na, p);
            document.getElementById("NCA").innerHTML = Cond1;
            $('#nascA').show();
        }

        function ScegliB() {
            nnb = document.getElementById("sceglia").value;
            nb = parseInt(nnb);
            Cond2 = potmod(A, nb, p);
            document.getElementById("NCB").innerHTML = Cond2;
            $('#nascB').show();
        }
    </script>
</head>

<body onload="Init()">
    <div id="DivCanvas">
        <div id="Text1">
            <p><span id="Trad1">Angela ha scelto per i due numeri: <br>un numero primo <em>p</em>:</span> <b id="Primo1"></b>, <br><span id="Trad2">e un numero <em>g</em> che sarà la nostra base:</span> <b id="Base1"></b></p>
            <p style="text-align:center;"><button onclick="$('#Text2').show();" id="Trad3">Ok, iniziamo!</button></p>
        </div>
        <div id="Text2">
            <p class="titolo" id="Trad4">Fase 2 (Leo): il segreto di Leo</p>
            <p><span id="Trad5">Ciao Mathina! Ho scelto segretamente un numero a, tra 2 e</span> <em class="pmuno">p-2</em>. <span id="Trad6">Poi ho calcolato</span> <em class="SegG">g</em><sup>a</sup>, <span id="Trad7">che vale</span> <span id="chia"></span></p>
            <p style="text-align:center;"><button onclick="$('#Text3').show();" id="Trad8">E adesso?</button></p>
            </p>
        </div>
        <div id="Text3">
            <p class="titolo" id="Trad9">Fase 2 (Mathina): il segreto di Mathina</p>
            <p><span id="Trad10">Ciao, Leo! Ho scelto segretamente un numero b, tra 2 e</span> <em class="pmuno">p-2</em>. <span id="Trad6a">Poi ho calcolato</span> <em class="SegG">g</em><sup>b</sup>, <span id="Trad7a">che vale</span> <span id="chib"></span></p>
            <p style="text-align:center;"><button onclick="$('#Text4').show();" id="Trad8a">E adesso?</button></p>
        </div>
        <div id="Text4">
            <p class="titolo" id="Trad11">Come procediamo?</p>
            <p><span id="Trad12">Dobbiamo trovare la chiave. Sappiamo che vale</span> <span class="SegCondB"></span><sup>a</sup>, <span id="Trad13">ma anche</span> <span class="SegCondA"></span><sup>b</sup>, <span id="Trad14">solo che non conoscendo a e b siamo obbligati a provare varie combinazioni.</span><br><br> <span id="Trad15">Scegli</span> a: <input type="text" id="sceglia" onchange="ScegliA()" />. <span id="nascA" style="display:none;"><span id="Trad16">Con questa scelta</span>, <span class="SegCondB"></span><sup id="NewA">a</sup> <span id="Trad17">modulo</span> <em class="SegP">p</em> = <em id="NCA"></em>
                </span><br><br> <span id="Trad15a">Scegli</span> b: <input type="text" id="sceglib" onchange="ScegliB()" />. <span id="nascB" style="display:none;"><span id="Trad16a">Con questa scelta</Span>, <span class="SegCondA"></span><sup id="NewB">b</sup> <span id="Trad17a">modulo</span><em class="SegP">p</em> = <em id="NCB"></em></span><br>
            </p>
            <p style="text-align:center;"><button onclick="$('#Text5').show();" id="Trad18">Ok, sono pronto a decodificare il messaggio</button></p>
        </div>
        <div id="Text5">
            <p class="titolo" id="Trad19">Riusciamo a decodificare il messaggio?</p>
            <p><span id="Trad20">Inserisci la chiave</span> <input type="text" id="chiavetrovata" onchange="CheckFinale()" /> <br> <span id="Trad21">Ecco il messaggio decodificato</span>: <br>
                <span id="messdec"></span>
            </p>
        </div>
    </div>
    <div class="block" style="display:none"> <input id="text" type="text" /> </div>
</body>

</html>